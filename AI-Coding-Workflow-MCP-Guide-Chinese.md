# AI编程助手工作流程与模型上下文协议(MCP)指南

*基于生产级流程构建高质量软件的AI编程助手综合指南*

## 目录

1. [介绍](#介绍)
2. [AI编程核心原则](#ai编程核心原则)
3. [理解模型上下文协议(MCP)](#理解模型上下文协议mcp)
4. [设置全局规则](#设置全局规则)
5. [项目结构和文档](#项目结构和文档)
6. [完整开发工作流程](#完整开发工作流程)
7. [提示词最佳实践](#提示词最佳实践)
8. [测试策略](#测试策略)
9. [容器化和部署](#容器化和部署)
10. [MCP生态系统和工具](#mcp生态系统和工具)

## 介绍

本指南概述了与AI编程助手协作构建生产级软件的可重复、结构化流程。该方法论将传统软件开发最佳实践与模型上下文协议(MCP)的革命性功能相结合，使AI助手能够与您的整个开发环境无缝交互。

## AI编程核心原则

### 黄金法则

1. **编码前规划**：始终与LLM对话来规划初始范围和任务
2. **结构化文档**：维护用于范围的`PLANNING.md`和用于具体任务的`TASK.md`
3. **全局规则执行**：使用项目级规则确保所有AI交互的一致性
4. **模块化架构**：永不创建超过500行代码的文件
5. **测试驱动开发**：始终为新功能创建单元测试
6. **持续文档更新**：当功能、依赖项或设置更改时更新README.md

### AI IDE支持

现代AI编程助手支持全局和项目级规则：

- **Cursor规则**：[上下文规则文档](https://docs.cursor.com/context/rules-for-ai)
- **Windsurf规则**：[内存管理](https://docs.codeium.com/windsurf/memories#windsurfrules)
- **Cline规则**：[提示词最佳实践](https://docs.cline.bot/improving-your-prompting-skills/prompting)
- **Roo Code规则**：与Cline类似的工作方式

## 理解模型上下文协议(MCP)

### 什么是MCP？

模型上下文协议(MCP)是Anthropic于2024年底推出的开放标准，使AI助手能够通过统一接口与外部工具、数据源和服务交互。与需要为每个工具进行自定义集成的传统方法不同，MCP为AI模型动态发现和使用功能提供了标准化方式。

### 主要优势

- **真正的工具集成**：AI助手可以直接与Git交互、运行测试、管理问题等
- **内存和上下文管理**：跨会话维护知识，创建"项目内存"
- **安全和控制**：隔离凭据并要求明确批准交互
- **动态发现**：AI可以发现可用工具并在运行时适应新服务器

### MCP架构

```
AI助手(客户端) ↔ MCP协议 ↔ MCP服务器 ↔ 外部工具/服务
```

MCP服务器充当中介，通过标准化接口公开特定功能，允许任何兼容MCP的AI助手使用它们。

## 设置全局规则

### 全局规则配置示例

```markdown
### 🔄 项目感知和上下文
- **始终阅读`PLANNING.md`** 在新对话开始时
- **检查`TASK.md`** 在开始任务之前
- **使用一致的命名约定** 如规划文档中所述

### 🧱 代码结构和模块化
- **永不创建超过500行的文件**
- **将代码组织成清晰分离的模块**
- **使用清晰一致的导入** (包内优先使用相对导入)

### 🧪 测试和可靠性
- **始终为新功能创建Pytest单元测试**
- **当逻辑更改时更新现有测试**
- **测试应位于`/tests`文件夹** 镜像应用结构
- 包括：预期使用、边缘情况和失败情况测试

### ✅ 任务完成
- **立即在`TASK.md`中标记已完成的任务**
- **将发现的子任务添加到"工作中发现"部分**

### 📎 样式和约定
- **使用Python** 作为主要语言
- **遵循PEP8** 使用类型提示和`black`格式化
- **使用`pydantic`** 进行数据验证
- **为每个函数编写文档字符串** 使用Google样式

### 🧠 AI行为规则
- **永不假设缺失的上下文** - 如果不确定就提问
- **永不虚构库** - 只使用经过验证的包
- **始终确认文件路径** 在引用之前存在
- **永不删除现有代码** 除非明确指示
```

## 项目结构和文档

### 必需文件

1. **PLANNING.md**：项目架构、目标、样式和约束
2. **TASK.md**：带有描述和日期的当前任务
3. **README.md**：设置说明、依赖项和功能文档
4. **requirements.txt**：Python依赖项
5. **.env.example**：环境变量模板

### 项目结构示例

```
project/
├── PLANNING.md
├── TASK.md
├── README.md
├── requirements.txt
├── .env.example
├── src/
│   ├── __init__.py
│   ├── main.py
│   ├── models/
│   ├── services/
│   └── utils/
├── tests/
│   ├── __init__.py
│   ├── test_main.py
│   └── test_services/
└── docs/
```

## 完整开发工作流程

### 阶段1：项目初始化

1. **创建项目结构** 包含必需的文档文件
2. **在PLANNING.md中定义范围**
3. **在TASK.md中列出初始任务**
4. **在AI IDE中设置全局规则**

### 阶段2：初始开发提示

第一个提示至关重要。包括：

- **详细需求** 包含具体示例
- **参考文档** (使用@docs引用外部文档)
- **您想构建的类似示例**
- **技术约束** 和偏好

提示结构示例：
```
使用@docs:model-context-protocol-docs和@docs:supabase-docs创建一个用Python编写的MCP服务器
(使用FastMCP)来与Supabase数据库交互。

服务器应使用Stdio传输并具有以下工具：
- 读取表中的行
- 在表中创建记录
- 更新表中的记录
- 删除表中的记录

为每个工具包含全面的描述。所需的环境变量：
SUPABASE_PROJECT_URL和SUPABASE_SERVICE_ROLE_KEY。

参考：https://github.com/modelcontextprotocol/python-sdk/tree/main

创建MCP服务器后，更新README.md和TASK.md。
```

### 阶段3：迭代开发

1. **单任务专注**：一次给出一个任务以获得一致的结果
2. **文件特定更改**：让LLM尽可能专注于更新单个文件
3. **文档更新**：更改后始终更新README.md、PLANNING.md和TASK.md
4. **定期测试**：为每个功能编写或更新单元测试

### 阶段4：质量保证

1. **代码审查**：审查生成的代码的安全性和最佳实践
2. **测试覆盖率**：确保全面的测试覆盖率
3. **文档审查**：验证所有文档都是最新和准确的

## 提示词最佳实践

### 有效的提示策略

1. **在需求中具体详细**
2. **提供正面和负面示例**
3. **为复杂任务请求逐步推理**
4. **在需要时使用XML标签** 进行结构化输出
5. **指定所需的长度和格式**

### 好坏示例对比

**好的提示：**
```
更新用户认证功能以包含速率限制，每个IP地址每分钟最多5次尝试。
使用Redis进行存储并返回适当的HTTP状态码。
```

**不好的提示：**
```
修复认证，添加速率限制，更新数据库架构，
重构API端点，并为所有内容编写新测试。
```

### 对话管理

- **重启对话** 当它们变得很长时(LLM开始出错)
- **通过文档文件维护上下文**
- **提出澄清问题** 而不是做假设

## 测试策略

### 测试要求

每个功能必须包括：
1. **预期使用案例测试**
2. **边缘情况测试**
3. **失败情况测试**

### 测试组织

```python
def test_user_creation_success():
    """测试使用有效数据成功创建用户。"""
    # 预期使用案例
    
def test_user_creation_duplicate_email():
    """测试使用重复邮箱创建用户失败。"""
    # 边缘情况
    
def test_user_creation_invalid_data():
    """测试使用无效输入创建用户失败。"""
    # 失败情况
```

### 测试最佳实践

- **在测试目录中镜像应用结构**
- **使用描述性测试名称** 解释场景
- **测试快乐路径和错误条件**
- **当逻辑更改时更新测试**
- **适当模拟外部依赖项**

## 容器化和部署

### Docker配置

```dockerfile
FROM python:3.12-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
CMD ["python", "server.py"]
```

### 构建命令

```bash
docker build -t mcp/supabase .
docker run -p 8000:8000 mcp/supabase
```

### 部署注意事项

- **使用Docker** 在各平台间进行一致部署
- **环境变量** 用于配置
- **健康检查** 用于监控
- **日志记录** 用于调试和监控

## MCP生态系统和工具

### 流行的MCP服务器

1. **文件系统服务器**：具有访问控制的安全文件操作
2. **Git/GitHub服务器**：仓库管理、代码搜索、PR审查
3. **数据库服务器**：各种数据库集成(PostgreSQL、MySQL等)
4. **通信服务器**：Slack、Discord、电子邮件集成
5. **云服务器**：AWS、Google Cloud、Azure集成
6. **开发工具**：测试框架、CI/CD管道

### MCP客户端支持

- **Claude Desktop**：来自Anthropic的原生MCP支持
- **Cursor**：内置MCP客户端的代码编辑器
- **Windsurf**：AI驱动的开发环境
- **Cline**：基于终端的AI助手
- **VS Code**：带有MCP支持的GitHub Copilot(预览版)

### 设置MCP

1. **在开发环境中安装MCP客户端**
2. **通过IDE设置或配置文件配置服务器**
3. **测试连接** 确保正确的服务器通信
4. **为受信任的服务器启用自动批准**(可选)

### MCP配置示例

```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/allowed/files"]
    },
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "your-token"
      }
    }
  }
}
```

## MCP和AI编程的未来

### 新兴趋势

1. **服务器注册表**：MCP服务器的集中发现
2. **工作流管理**：对多步骤流程的内置支持
3. **跨平台集成**：无缝工具连接
4. **企业采用**：内部工具的自定义MCP服务器

### 对开发的影响

- **减少上下文切换**：AI可以直接访问所有工具
- **提高准确性**：实时访问当前项目状态
- **增强协作**：跨开发团队共享知识
- **更快迭代**：带有人工监督的自动化工作流

## 结论

结构化AI编程工作流与模型上下文协议的结合代表了软件开发的根本性转变。通过遵循这些实践，开发者可以：

- 更快地构建生产级软件
- 保持项目间的一致性
- 有效利用AI同时保持控制
- 创建更可维护和可测试的代码

开发的未来在于人类和AI之间的这种协作方法，开发者专注于创造性问题解决，而AI处理具有完美项目上下文知识的实现细节。

---

*本指南综合了AI编程社区的最佳实践和真实世界的MCP实现。有关最新信息，请参考官方MCP文档和社区资源。*